


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hello, Machines! &mdash; Bittensor Documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Installation" href="getting_started.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://bittensor.com" aria-label="Bittensor"></a>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   
  <div>

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hello, Machines!</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Bittensor</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bittensor/model_components.html">Components of a Bittensor Model</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">

      <section data-toggle="wy-nav-shift" class="pytorch-content-wrap">
        <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
          <div class="pytorch-breadcrumbs-wrapper">
            















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Hello, Machines!</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/getting-started/hello_world.md.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
          </div>

          <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
            Shortcuts
          </div>
        </div>

        <div class="pytorch-content-left">
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" class="pytorch-article">
              
  <div class="section" id="hello-machines">
<h1>Hello, Machines!<a class="headerlink" href="#hello-machines" title="Permalink to this headline">¶</a></h1>
<p>With Bittensor installed, let’s try running one of the examples! Each example is basically driver code for the models you build inside <a class="reference external" href="https://github.com/opentensor/bittensor/tree/master/bittensor/synapses">bittensor/synapses</a>. This will give you an overview to the development flow of Bittensor as well as what to expect when creating new models.</p>
<p>For this example, we will be running <code class="docutils literal notranslate"><span class="pre">examples/gpt2-wiki.py</span></code> which is exactly what it sounds like: a very small version of <a class="reference external" href="https://huggingface.co/transformers/model_doc/gpt2.html">HuggingFace OpenAI GPT2</a>.</p>
<p>Each example is powered by a <a class="reference external" href="https://github.com/opentensor/bittensor/tree/master/bittensor/synapses"><code class="docutils literal notranslate"><span class="pre">Synapse</span></code></a>. Synapses are where you would be building and setting up your PyTorch model. We will cover Synapses later in this documentation. Within each example, there is a class <code class="docutils literal notranslate"><span class="pre">Session()</span></code> that is responsible for training, testing, and setting up your model. <em>This is an optional naming and development convention and is not required for the functionality of Bittensor.</em></p>
<div class="section" id="training-flow">
<h2>Training flow<a class="headerlink" href="#training-flow" title="Permalink to this headline">¶</a></h2>
<p>The general training flow in the Bittensor network can be summarized as follows, all examples follow the same flow:</p>
<ol>
<li><p>Initialize your model with one you created in <a class="reference external" href="https://github.com/opentensor/bittensor/tree/master/bittensor/synapses"><code class="docutils literal notranslate"><span class="pre">Synapse</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">GPT2LMSynapse</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Set up your optimizer, scheduler, and dataset.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">WarmupCosineWithHardRestartsSchedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;ag_news&#39;</span><span class="p">)[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">self.config</span></code> is generated from the command line arguments or an optional <code class="docutils literal notranslate"><span class="pre">configuration.yaml</span></code>. In this example, we simply load a pre-loaded dataset from the <code class="docutils literal notranslate"><span class="pre">datasets</span></code> library called <a class="reference external" href="https://huggingface.co/datasets/ag_news">ag_news</a>. This is a small dataset that can be run on any machine without eating up the memory with batches.</p>
</li>
<li><p>Set up your device where your model will run.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Start a <a class="reference external" href="https://github.com/opentensor/bittensor/blob/master/bittensor/neuron.py">Neuron</a> session. Neurons allow you to start communicating with nodes in the bittensor network.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron</span><span class="p">:</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>Each neuron has an <a class="reference external" href="https://github.com/opentensor/bittensor/blob/master/bittensor/axon.py">Axon</a> terminal that serves a grpc endpoint which provides access to other synapses on other nodes. Each neuron also has a <a class="reference external" href="https://github.com/opentensor/bittensor/blob/master/bittensor/dendrite.py">Dendrite</a> which is a differentiable object used to make calls to the network.</p>
</div></blockquote>
<ol>
<li><p>Now is when you define your training epoch loop. In the examples, we simply train forever using <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> but you can define it to be any number of epochs you wish to use. The first thing we do in this loop is we serve the model on the Axon. This is because after each loop we update our model and so we always want to serve the latest version of our model.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">neuron</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>The fun part starts here, though very straightforward. We can now start training our model. After obtaining the inputs and possibly targets for the current batch, we can just call our model:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remote_forward</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neuron</span><span class="p">,</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
            <span class="n">training</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>We call the synapse model’s <code class="docutils literal notranslate"><span class="pre">remote_forward</span></code> call as it will run a local forward call and send the present batch of inputs to experts on the network for processing as well. Once the experts have made their own forward call, they will respond with their outputs back to us. The remote expert’s output is then used as input into our model.</p>
<blockquote>
<div><p>We now have 3 training losses:</p>
<ul class="simple">
<li><p><strong>local_target_loss</strong>: The loss of our local model with respect to the local target inputs.</p></li>
<li><p><strong>remote_target_loss</strong>: The loss of the remote models.</p></li>
<li><p><strong>distillation_loss</strong>: The loss of the <a class="reference external" href="https://arxiv.org/abs/1503.02531">distilled</a> version of the model deployed on the &gt;network. This model is the one we can download from the network and use in production.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>We can sum all our losses now and run a backwards call to accumulate the gradients on the model, then apply them and zero our gradients again.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>     <span class="n">loss</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">local_target_loss</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">distillation_loss</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">remote_target_loss</span>
     <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="c1"># Accumulates gradients on the model.</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="c1"># Applies accumulated gradients.</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span> <span class="c1"># Zeros out gradients for next accummulation</span>
</pre></div>
</div>
</li>
<li><p>Finally, we have to train our row weights. This is so that we can emit these weights to the network and update our list of experts that we communicate with.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>        <span class="n">batch_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="mf">0.97</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">+</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="n">batch_weights</span> <span class="c1"># Moving avg update.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Ensure normalization.</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>And that’s it! You can peruse through any of the examples and see how we are applying all these steps to create models that run forever and trade information with other models.</strong></p>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ala Shaabana, Jacob Steeves, Daniel Attevelt, the Bittensor community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Hello, Machines!</a><ul>
<li><a class="reference internal" href="#training-flow">Training flow</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    
  </div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://bittensor.com" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    mobileMenu.bind();
    mobileTOC.bind();
    pytorchAnchors.bind();

    $(window).on("load", function() {
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
    })

    // Add class to links that have code blocks, since we cannot create links in code blocks
    $("article.pytorch-article a span.pre").each(function(e) {
      $(this).closest("a").addClass("has-code");
    });
  </script>
</body>
</html>